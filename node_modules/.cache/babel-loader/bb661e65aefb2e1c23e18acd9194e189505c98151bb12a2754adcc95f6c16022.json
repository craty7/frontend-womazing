{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/hp/Desktop/JavaScript (05.11.2022)/project clothes shop(18.03.2023)/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/hp/Desktop/JavaScript (05.11.2022)/project clothes shop(18.03.2023)/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/hp/Desktop/JavaScript (05.11.2022)/project clothes shop(18.03.2023)/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/hp/Desktop/JavaScript (05.11.2022)/project clothes shop(18.03.2023)/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useEffect,useState}from'react';import axios from\"axios\";import{UserContext}from\"../../App\";import{useNavigate}from\"react-router-dom\";import{toast}from\"react-toastify\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function SignInForm(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),username=_useState4[0],setUsername=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),password=_useState6[0],setPassword=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var navigate=useNavigate();var _useContext=useContext(UserContext),user=_useContext.user,setUser=_useContext.setUser,setRef=_useContext.setRef;useEffect(function(){error&&alert('Неправильные данные');},[error]);function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(username&&password)){_context.next=8;break;}_context.next=4;return axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/auth/local\"),{identifier:username,password:password}).then(function(res){toAuth();document.cookie=\"jwt=\".concat(res.data.jwt);// document.cookie - внутри куки создает ключ 'jwt'\ndocument.cookie=\"active=\".concat(true);localStorage.setItem('jwt',res.data.jwt);localStorage.setItem('active','true');localStorage.setItem('user',JSON.stringify(res.data.user));toast.success('Вы успешно вошли в аккаунт!',{position:\"top-center\",autoClose:2000,hideProgressBar:true});setUser(function(prev){return _objectSpread(_objectSpread({},prev),{},{jwt:res.data.jwt,active:true});});navigate('/');setRef(true);}).catch(function(e){return setError(true);});case 4:setEmail('');setUsername('');setPassword('');return _context.abrupt(\"return\");case 8:alert('Заполните поля');case 9:case\"end\":return _context.stop();}},_callee);}));return _handleSubmit.apply(this,arguments);}function toAuth(){return _toAuth.apply(this,arguments);}function _toAuth(){_toAuth=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.put(\"\".concat(process.env.REACT_APP_API_URL,\"/users/\").concat(user.user.id),{role:1});case 2:case\"end\":return _context2.stop();}},_callee2);}));return _toAuth.apply(this,arguments);}return/*#__PURE__*/_jsx(\"div\",{className:\"section\",children:/*#__PURE__*/_jsx(\"div\",{className:\"box px-6 py-4\",children:/*#__PURE__*/_jsxs(\"form\",{action:\"\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{className:\"input my-1\",type:\"text\",onInput:function onInput(event){return setUsername(event.target.value);},value:username,placeholder:\"Username...\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input my-1\",type:\"password\",onInput:function onInput(event){return setPassword(event.target.value);},value:password,placeholder:\"Password...\"}),/*#__PURE__*/_jsx(\"button\",{style:{backgroundColor:'#509498'},className:\"button mt-4 has-text-white\",children:\"Login\"})]})})});}export default SignInForm;// чтобы хранил jwt при регистрации","map":{"version":3,"names":["React","useContext","useEffect","useState","axios","UserContext","useNavigate","toast","jsx","_jsx","jsxs","_jsxs","SignInForm","props","_useState","_useState2","_slicedToArray","email","setEmail","_useState3","_useState4","username","setUsername","_useState5","_useState6","password","setPassword","_useState7","_useState8","error","setError","navigate","_useContext","user","setUser","setRef","alert","handleSubmit","_x","_handleSubmit","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","wrap","_callee$","_context","prev","next","preventDefault","post","concat","process","env","REACT_APP_API_URL","identifier","then","res","toAuth","document","cookie","data","jwt","localStorage","setItem","JSON","stringify","success","position","autoClose","hideProgressBar","_objectSpread","active","catch","abrupt","stop","_toAuth","_callee2","_callee2$","_context2","put","id","role","className","children","action","onSubmit","type","onInput","event","target","value","placeholder","style","backgroundColor"],"sources":["C:/Users/hp/Desktop/JavaScript (05.11.2022)/project clothes shop(18.03.2023)/frontend/src/components/SignInForm/SignInForm.jsx"],"sourcesContent":["import React, {useContext, useEffect, useState} from 'react';\r\nimport axios from \"axios\";\r\nimport {UserContext} from \"../../App\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {toast} from \"react-toastify\";\r\n\r\n\r\nfunction SignInForm(props) {\r\n    const [email, setEmail] = useState('')\r\n    const [username, setUsername] = useState('')\r\n    const [password, setPassword] = useState('')\r\n    const [error, setError] = useState(false)\r\n    const navigate = useNavigate()\r\n    const {user, setUser, setRef} = useContext(UserContext)\r\n\r\n    useEffect(() => {\r\n        error && alert('Неправильные данные')\r\n    }, [error])\r\n\r\n    async function handleSubmit(e) {\r\n        e.preventDefault()\r\n        if (username && password) {\r\n            await axios.post(`${process.env.REACT_APP_API_URL}/auth/local`, {\r\n                identifier: username,\r\n                password: password,\r\n            }).then(\r\n                res => {\r\n                    toAuth()\r\n                    document.cookie = `jwt=${res.data.jwt}` // document.cookie - внутри куки создает ключ 'jwt'\r\n                    document.cookie = `active=${true}`\r\n                    localStorage.setItem('jwt', res.data.jwt)\r\n                    localStorage.setItem('active', 'true')\r\n                    localStorage.setItem('user', JSON.stringify(res.data.user))\r\n\r\n                    toast.success('Вы успешно вошли в аккаунт!', {\r\n                        position: \"top-center\",\r\n                        autoClose: 2000,\r\n                        hideProgressBar: true\r\n                    })\r\n\r\n                    setUser(prev => {\r\n                        return {\r\n                            ...prev,\r\n                            jwt: res.data.jwt,\r\n                            active: true\r\n                        }\r\n                    })\r\n                    navigate('/')\r\n                    setRef(true)\r\n                }\r\n            ).catch(e => setError(true))\r\n            setEmail('')\r\n            setUsername('')\r\n            setPassword('')\r\n            return\r\n       }\r\n       alert('Заполните поля')\r\n    }\r\n\r\n    async function toAuth() {\r\n        await axios.put(`${process.env.REACT_APP_API_URL}/users/${user.user.id}`, {\r\n            role: 1\r\n        })\r\n    }\r\n\r\n    return (\r\n        <div className='section'>\r\n            <div className='box px-6 py-4'>\r\n                <form action=\"\" onSubmit={handleSubmit}>\r\n                    <input className='input my-1' type=\"text\" onInput={event => setUsername(event.target.value)} value={username} placeholder='Username...'/>\r\n                    <input className='input my-1' type=\"password\" onInput={event => setPassword(event.target.value)} value={password} placeholder='Password...'/>\r\n                    <button style={{backgroundColor: '#509498'}} className='button mt-4 has-text-white'>Login</button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SignInForm;\r\n\r\n// чтобы хранил jwt при регистрации"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}